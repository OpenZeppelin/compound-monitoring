service: generated-service
configValidationMode: error
frameworkVersion: "3"

provider:
  name: defender
  stage: dev
  stackName: forta_large_delegations
  ssot: false

custom:
  config: ${file(../secrets.yml)}
  stackSecrets: ${self:custom.config.secrets.${self:provider.stackName}}
  discordWebhook: ${self:custom.stackSecrets.discordWebhook}
  
  # Configure this section and rename secret-example.yml to secrets.yml
  name: Forta Large Delegations

  # Forta Sentinel Settings
  alert-ids:
    - AE-COMP-GOVERNANCE-DELEGATE-THRESHOLD
  agent-ids:
    - "0x0d3cdcc2757cd7837e3b302a9889c854044a80835562dc8060d7c163fbb69d53"

defender:
  key: ${self:custom.config.keys.api}
  secret: ${self:custom.config.keys.secret}

functions:
  autotask-1:
    name: ${self:custom.name} Filter
    trigger:
      type: schedule
      frequency: 0
    paused: true
    path: 'autotask-1'

resources:
  Resources:
    notifications:
     security-alerts:
        type: discord
        name: '${self:custom.name} Security Alerts'
        config:
          url:  ${self:custom.discordWebhook}
        paused: false
    sentinels:
      forta-large-delegations-monitor:
        name: '${self:custom.name} Sentinel'
        type: 'FORTA'
        network: mainnet
        paused: false
        notify-config:
          timeout: 0
          message: '[TX]({{ metadata.transactionLink }}) {{ metadata.message }}'
          message-subject: 'Defender Sentinel: Forta Large Delegations Monitor triggered'
          channels:
            - ${self:resources.Resources.notifications.security-alerts}
        autotask-condition: ${self:functions.autotask-1}
        conditions:
          min-scanner-count: 1
          severity: 1
          alert-ids:
            - ${self:custom.alert-ids}
        agent-ids:
          - ${self:custom.agent-ids}
plugins:
  - defender-serverless
